(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{7975:(e,t,i)=>{Promise.resolve().then(i.bind(i,8027))},8027:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>T});var a=i(5155),s=i(2115),n=i(2225),r=i(3578),l=i(4229),d=i(9708),o=i(2085),c=i(2596),h=i(9688);function g(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,h.QP)((0,c.$)(t))}let m=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function u(e){let{className:t,variant:i,size:s,asChild:n=!1,...r}=e,l=n?d.DX:"button";return(0,a.jsx)(l,{"data-slot":"button",className:g(m({variant:i,size:s,className:t})),...r})}let x=e=>{let{activeTool:t,onToolSelect:i,onSave:s,isSaving:d}=e;return(0,a.jsxs)("div",{className:"flex justify-between items-center p-2 border-b",children:[(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)(u,{variant:"pointer"===t?"secondary":"ghost",size:"icon",onClick:()=>i("pointer"),"aria-label":"Pointer",children:(0,a.jsx)(n.A,{className:"h-5 w-5"})})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(u,{variant:"map"===t?"secondary":"ghost",size:"icon",onClick:()=>i("map"),"aria-label":"Map",children:(0,a.jsx)(r.A,{className:"h-5 w-5"})}),(0,a.jsx)(u,{variant:"ghost",size:"icon",onClick:s,"aria-label":"Save",disabled:d,children:(0,a.jsx)(l.A,{className:"h-5 w-5"})})]})]})},p={islands:"Остров",start:"Старт",fruits:"Фрукты",stones:"Камни",water:"Вода",trees:"Деревья",finish:"Финиш",extra:"Экстра"},f={islands:[{name:"Остров 1",image:"/assets/islands/island_1.png"},{name:"Остров 2",image:"/assets/islands/island_2.png"},{name:"Остров 3",image:"/assets/islands/island_3.png"}],start:[{name:"Корова",image:"/assets/hero/hero_cow.png"},{name:"Кот",image:"/assets/hero/hero_cat.png"}],fruits:[{name:"Яблоко",image:"/assets/fruits/apple.png"},{name:"Банан",image:"/assets/fruits/banana.png"},{name:"Ягода",image:"/assets/fruits/berry.png"},{name:"Капуста",image:"/assets/fruits/cabbage.png"},{name:"Морковь",image:"/assets/fruits/carrot.png"},{name:"Виноград",image:"/assets/fruits/grape.png"}],stones:[{name:"Камень 1",image:"/assets/stones/stone_1.png"},{name:"Камень 2",image:"/assets/stones/stone_2.png"},{name:"Камень 3",image:"/assets/stones/stone_3.png"}],water:[{name:"Вода 1",image:"/assets/water/water_1.png"},{name:"Вода 2",image:"/assets/water/water_2.png"},{name:"Вода 3",image:"/assets/water/water_3.png"},{name:"Вода 4",image:"/assets/water/water_4.png"}],trees:[{name:"Дерево 1",image:"/assets/trees/tree_1.png"},{name:"Дерево 2",image:"/assets/trees/tree_2.png"},{name:"Дерево 3",image:"/assets/trees/tree_3.png"},{name:"Дерево 4",image:"/assets/trees/tree_4.png"}],finish:[{name:"Финиш 1",image:"/assets/finish/finish_1.png"}],extra:[{name:"Экстра 1",image:"/assets/extra/extra_1.png"}]};var v=i(6766);function b(e){let{className:t,type:i,...s}=e;return(0,a.jsx)("input",{type:i,"data-slot":"input",className:g("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...s})}var j=i(968);function w(e){let{className:t,...i}=e;return(0,a.jsx)(j.b,{"data-slot":"label",className:g("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...i})}var N=i(7484),y=i(5196);function k(e){let{className:t,...i}=e;return(0,a.jsx)(N.bL,{"data-slot":"checkbox",className:g("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...i,children:(0,a.jsx)(N.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,a.jsx)(y.A,{className:"size-3.5"})})})}var S=i(7489);function C(e){let{className:t,orientation:i="horizontal",decorative:s=!0,...n}=e;return(0,a.jsx)(S.b,{"data-slot":"separator",decorative:s,orientation:i,className:g("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t),...n})}let O=["fruits","stones","water","trees","finish","extra"],z={fruits:"фрукт",stones:"камень",trees:"дерево",finish:"финиш",extra:"экстра",water:"объект"},_={fruits:"fruit",stones:"stone",trees:"tree",finish:"finish",extra:"extra",water:"water"},I=e=>{let{content:t,setContent:i,levels:n,currentLevelName:r,loadLevel:l,onCreateLevel:d,canvasSize:o,setCanvasSize:c,placingObject:h,setPlacingObject:m,fruitDimensions:x,onFruitDimensionChange:j,stoneDimensions:N,onStoneDimensionChange:y,waterDimensions:S,onWaterDimensionChange:I,treeDimensions:F,onTreeDimensionChange:P,finishDimensions:W,onFinishDimensionChange:H,extraDimensions:J,onExtraDimensionChange:D}=e,[A,E]=(0,s.useState)("islands"),[L,M]=(0,s.useState)(null),[R,T]=(0,s.useState)(!0),[X,U]=(0,s.useState)({width:0,height:0});(0,s.useEffect)(()=>{M(null)},[A]);let Y=e=>{if((null==h?void 0:h.name)===e.name)m(null),M(null);else{let t=new window.Image;t.src=e.image,t.onload=()=>{let i,a,s="fruits"===A,n="stones"===A,r="water"===A,l="trees"===A,d="finish"===A,o="extra"===A,c=x;n&&(c=N),r&&(c=S),l&&(c=F),d&&(c=W),o&&(c=J);let h=c[e.name];if((s||n||r||l||d||o)&&h)i=h.width,a=h.height;else if(s||n||r||l||d||o)i=64,a=64;else{let e=Math.min(1,128/t.naturalWidth,128/t.naturalHeight);i=t.naturalWidth*e,a=t.naturalHeight*e}m({...e,width:i,height:a,originalWidth:t.naturalWidth,originalHeight:t.naturalHeight}),s||n||r||l||d||o?(M(e.name),U({width:i,height:a})):M(null)}}},V=(e,t)=>{let i=Number(t);!isNaN(i)&&i>0&&c({...o,[e]:i})},B=(e,t,i)=>{let a=Number(t);if(L&&!isNaN(a)&&a>0)if(R){let t={fruitDimensions:x,stoneDimensions:N,waterDimensions:S,treeDimensions:F,finishDimensions:W,extraDimensions:J}["".concat(i,"Dimensions")][L],s=t?t.width/t.height:1;"width"===e?U({width:a,height:Math.round(a/s)}):U({width:Math.round(a*s),height:a})}else U(t=>({...t,[e]:a}))},G=()=>{if(L&&A){let e={fruits:j,stones:y,water:I,trees:P,finish:H,extra:D}[A];e&&e(L,X)}};return(0,a.jsx)("div",{className:"py-2",children:(()=>{if("levels"===t)return(0,a.jsxs)("div",{className:"p-4 flex flex-col space-y-2",children:[(0,a.jsx)(u,{onClick:d,className:"w-full",children:"Создать новый уровень"}),(0,a.jsx)("div",{className:"flex flex-col space-y-1 mt-2",children:Object.keys(n).map(e=>(0,a.jsx)(u,{variant:r===e?"secondary":"ghost",onClick:()=>l(e),className:"w-full justify-start",children:e},e))})]});if("settings"===t)return(0,a.jsxs)("div",{className:"p-4 flex flex-col space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Настройки"}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(w,{htmlFor:"canvas-width",children:"Ширина"}),(0,a.jsx)(b,{id:"canvas-width",type:"number",value:o.width,onChange:e=>V("width",e.target.value)})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(w,{htmlFor:"canvas-height",children:"Высота"}),(0,a.jsx)(b,{id:"canvas-height",type:"number",value:o.height,onChange:e=>V("height",e.target.value)})]})]});let e=A?f[A]:null,i=A&&O.includes(A),s=A?"random_".concat(_[A]||A):"",c=A?"/assets/".concat(A,"/random_").concat(_[A]||A,".png"):"",j=A?"Случайный ".concat(z[A]||p[A]):"";return(0,a.jsxs)("div",{className:"p-4 flex flex-col gap-4 h-full",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Элементы"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:Object.entries(p).map(e=>{let[t,i]=e;return(0,a.jsx)(u,{variant:A===t?"secondary":"outline",size:"sm",onClick:()=>E(t),children:i},t)})})]}),(0,a.jsx)("div",{className:"flex-grow overflow-y-auto",children:A&&e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium capitalize mt-6 mb-4",children:p[A]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[e.map(e=>(0,a.jsx)("button",{className:g("p-2 rounded-md border-2 hover:bg-accent",(null==h?void 0:h.name)===e.name?"border-primary":"border-transparent"),onClick:()=>Y(e),children:(0,a.jsx)("div",{className:"flex flex-col items-center gap-1",children:(0,a.jsx)(v.default,{src:e.image,alt:e.name,width:56,height:56})})},e.name)),i&&A&&(0,a.jsx)("button",{className:g("p-2 rounded-md border-2 hover:bg-accent",(null==h?void 0:h.name)===s?"border-primary":"border-transparent"),onClick:()=>{if((null==h?void 0:h.name)===s)m(null),M(null);else{let e={fruits:x,stones:N,water:S,trees:F,finish:W,extra:J}[A],t=e?e[s]:void 0,i=(null==t?void 0:t.width)||64,a=(null==t?void 0:t.height)||64;m({name:s,image:c,width:i,height:a,originalWidth:i,originalHeight:a}),M(s)}},children:(0,a.jsx)("div",{className:"flex flex-col items-center gap-1",children:(0,a.jsx)(v.default,{src:c,alt:j,width:56,height:56})})},s)]})]})]})}),L&&("fruits"===A||"stones"===A||"water"===A||"trees"===A||"finish"===A||"extra"===A)&&(0,a.jsxs)("div",{children:[(0,a.jsx)(C,{}),(0,a.jsxs)("h3",{className:"text-lg font-medium capitalize mt-6 mb-4",children:["Размер для: ",L]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(w,{htmlFor:"item-width",children:"Ширина"}),(0,a.jsx)(b,{id:"item-width",type:"number",value:X.width,onChange:e=>B("width",e.target.value,A)})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(w,{htmlFor:"item-height",children:"Высота"}),(0,a.jsx)(b,{id:"item-height",type:"number",value:X.height,onChange:e=>B("height",e.target.value,A)})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-4",children:[(0,a.jsx)(k,{id:"keep-aspect-ratio",checked:R,onCheckedChange:e=>T(!!e)}),(0,a.jsx)(w,{htmlFor:"keep-aspect-ratio",children:"Сохранять пропорции"})]}),(0,a.jsx)(u,{className:"mt-4",onClick:G,children:"Сохранить"})]})]})})()})};var F=i(1725);function P(e){let{className:t,...i}=e;return(0,a.jsx)(F.bL,{"data-slot":"tabs",className:g("flex flex-col gap-2",t),...i})}function W(e){let{className:t,...i}=e;return(0,a.jsx)(F.B8,{"data-slot":"tabs-list",className:g("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...i})}function H(e){let{className:t,...i}=e;return(0,a.jsx)(F.l9,{"data-slot":"tabs-trigger",className:g("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...i})}function J(e){let{className:t,...i}=e;return(0,a.jsx)(F.UC,{"data-slot":"tabs-content",className:g("flex-1 outline-none",t),...i})}var D=i(2525);let A=e=>{let{objects:t,onSelectObject:i,selectedObject:s}=e,n=(e=>{let t=new Map;e.forEach(e=>{t.set(e.id,{...e,children:[]})});let i=[];return e.forEach(e=>{if(e.parentId&&t.has(e.parentId)){var a;let i=t.get(e.parentId);null==i||null==(a=i.children)||a.push(t.get(e.id))}else i.push(t.get(e.id))}),i})(t),r=e=>(0,a.jsx)("div",{className:"pl-4",children:e.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)(u,{variant:"ghost",onClick:()=>i(e),className:g("w-full justify-start px-2 py-1 h-auto",(null==s?void 0:s.id)===e.id&&"bg-accent text-accent-foreground"),children:(0,a.jsx)("span",{className:"text-sm",children:e.name})}),e.children&&e.children.length>0&&r(e.children)]},e.id))});return(0,a.jsx)("div",{children:r(n)})},E=e=>{let{mapObjects:t,selectedObject:i,onSelectObject:n,onUpdateObject:r,onDeleteObject:l,leftPanelContent:d,canvasSize:o,setCanvasSize:c,keepAspectRatio:h,setKeepAspectRatio:g}=e,[m,x]=(0,s.useState)("properties"),p=(e,t)=>{if(!i)return;let a={...i,[e]:t};if(h)if("width"===e&&i.originalWidth&&i.originalHeight){let e=i.originalHeight/i.originalWidth;a.height=Number(t)*e}else if("height"===e&&i.originalWidth&&i.originalHeight){let e=i.originalWidth/i.originalHeight;a.width=Number(t)*e}else"widthPercent"===e&&i.originalWidth&&i.originalHeight?a.height=i.originalHeight*(Number(t)/100):"heightPercent"===e&&i.originalWidth&&i.originalHeight&&(a.width=i.originalWidth*(Number(t)/100));"widthPercent"===e&&i.originalWidth?a.width=i.originalWidth*(Number(t)/100):"heightPercent"===e&&i.originalHeight&&(a.height=i.originalHeight*(Number(t)/100)),r(a)},f=(e,t)=>{c({...o,[e]:Number(t)||0})};return"levels"===d?(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Размеры уровня"}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(w,{htmlFor:"width",children:"Ширина"}),(0,a.jsx)(b,{id:"width",type:"number",value:o.width,onChange:e=>f("width",e.target.value),min:100})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(w,{htmlFor:"height",children:"Высота"}),(0,a.jsx)(b,{id:"height",type:"number",value:o.height,onChange:e=>f("height",e.target.value),min:100})]})]}):(0,a.jsx)("div",{className:"p-4 h-full flex flex-col",children:(0,a.jsxs)(P,{value:m,onValueChange:e=>x(e),className:"w-full",children:[(0,a.jsxs)(W,{className:"grid w-full grid-cols-2",children:[(0,a.jsx)(H,{value:"properties",children:"Свойства"}),(0,a.jsx)(H,{value:"tree",children:"Дерево"})]}),(0,a.jsx)(J,{value:"tree",className:"flex-grow",children:(0,a.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Дерево объектов"}),(0,a.jsx)(A,{objects:t,onSelectObject:n,selectedObject:i})]})}),(0,a.jsx)(J,{value:"properties",className:"flex-grow",children:(0,a.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Свойства объекта"}),i&&(0,a.jsx)(u,{variant:"destructive",size:"icon",onClick:()=>l(i.id),children:(0,a.jsx)(D.A,{className:"h-4 w-4"})})]}),i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(w,{htmlFor:"name",children:"Имя"}),(0,a.jsx)(b,{id:"name",value:i.name,onChange:e=>r({...i,name:e.currentTarget.value})})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(w,{htmlFor:"width",children:"Ширина (пикс.)"}),(0,a.jsx)(b,{id:"width",type:"number",value:Math.round(i.width),onChange:e=>p("width",e.target.value),min:1})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(w,{htmlFor:"height",children:"Высота (пикс.)"}),(0,a.jsx)(b,{id:"height",type:"number",value:Math.round(i.height),onChange:e=>p("height",e.target.value),min:1})]}),i.originalWidth&&(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(w,{htmlFor:"widthPercent",children:"Ширина (%)"}),(0,a.jsx)(b,{id:"widthPercent",type:"number",value:Math.round(i.width/i.originalWidth*100),onChange:e=>p("widthPercent",e.target.value),min:1})]}),i.originalHeight&&(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(w,{htmlFor:"heightPercent",children:"Высота (%)"}),(0,a.jsx)(b,{id:"heightPercent",type:"number",value:Math.round(i.height/i.originalHeight*100),onChange:e=>p("heightPercent",e.target.value),min:1})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(k,{id:"keepAspectRatio",checked:h,onCheckedChange:e=>g(!!e)}),(0,a.jsx)(w,{htmlFor:"keepAspectRatio",children:"Сохранять пропорции"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsx)(u,{variant:"outline",onClick:()=>r({...i,flipX:!i.flipX}),children:"Отразить X"}),(0,a.jsx)(u,{variant:"outline",onClick:()=>r({...i,flipY:!i.flipY}),children:"Отразить Y"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(k,{id:"isLocked",checked:i.isLocked,onCheckedChange:e=>p("isLocked",!!e)}),(0,a.jsx)(w,{htmlFor:"isLocked",children:"Заблокировать"})]})]}):(0,a.jsx)("p",{className:"text-muted-foreground",children:"Объект не выбран"})]})})]})})};var L=i(5028),M=i(6671);let R=(0,L.default)(()=>Promise.all([i.e(413),i.e(650),i.e(60)]).then(i.bind(i,7060)),{loadableGenerated:{webpack:()=>[7060]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"flex-grow flex justify-center items-center bg-gray-100",children:(0,a.jsx)("p",{children:"Loading Canvas..."})})});function T(){let[e,t]=(0,s.useState)({}),[i,n]=(0,s.useState)(""),[r,l]=(0,s.useState)([]),[d,o]=(0,s.useState)(null),[c,h]=(0,s.useState)("pointer"),[g,m]=(0,s.useState)("islands"),[u,p]=(0,s.useState)(null),[f,v]=(0,s.useState)(!0),[b,j]=(0,s.useState)(!1),[w,N]=(0,s.useState)({width:800,height:600}),y=(0,s.useRef)(null),[k,S]=(0,s.useState)({}),[C,O]=(0,s.useState)({}),[z,_]=(0,s.useState)({}),[F,P]=(0,s.useState)({}),[W,H]=(0,s.useState)({}),[J,D]=(0,s.useState)({}),[A,L]=(0,s.useState)({}),[T,X]=(0,s.useState)({}),U=async()=>{let e=await fetch("/api/levels"),i=await e.json();return t(i),i};(0,s.useEffect)(()=>{(async()=>{let e=await U(),t=Object.keys(e),i=localStorage.getItem("maze-editor-last-level-name");i&&e[i]?Y(i,e):t.length>0&&Y(t[0],e)})()},[]),(0,s.useEffect)(()=>{"map"===c?m("levels"):"pointer"===c&&"levels"===g&&m("islands")},[c]),(0,s.useEffect)(()=>{let e=localStorage.getItem("fruit-dimensions");e&&_(JSON.parse(e));let t=localStorage.getItem("stone-dimensions");t&&P(JSON.parse(t));let i=localStorage.getItem("water-dimensions");i&&H(JSON.parse(i));let a=localStorage.getItem("tree-dimensions");a&&D(JSON.parse(a));let s=localStorage.getItem("finish-dimensions");s&&L(JSON.parse(s));let n=localStorage.getItem("extra-dimensions");n&&X(JSON.parse(n));let r=localStorage.getItem("island-dimensions");r&&S(JSON.parse(r));let l=localStorage.getItem("start-dimensions");l&&O(JSON.parse(l))},[]),(0,s.useEffect)(()=>{u?h("placing"):"placing"===c&&h("pointer")},[u]);let Y=(e,t)=>{let i=t[e];i&&(l(i.objects||[]),N(i.dimensions||{width:800,height:600}),n(e),o(null),localStorage.setItem("maze-editor-last-level-name",e))},V=async()=>{let t=prompt("Введите имя нового уровня:","Уровень ".concat(Object.keys(e).length+1));if(t){if(e[t])return void alert("Уровень с таким именем уже существует.");try{await fetch("/api/save-level",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,data:{objects:[],dimensions:{width:800,height:600}}})});let e=await U();Y(t,e)}catch(e){console.error("Ошибка при создании уровня:",e),alert("Не удалось создать уровень: ".concat(e))}}},B=async()=>{if(!i)return void M.oR.error("Ошибка",{description:"Не выбран уровень для сохранения."});j(!0);try{await fetch("/api/save-level",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,data:{objects:r,dimensions:w}})}),M.oR.success("Сохранено",{description:'Уровень "'.concat(i,'" успешно сохранен.')})}catch(e){console.error("Ошибка при сохранении уровня:",e),M.oR.error("Ошибка сохранения",{description:"Не удалось сохранить уровень: ".concat(e)})}finally{j(!1)}o(null)},G=e=>{e.id&&(l(r.map(t=>t.id===e.id?{...t,...e}:t)),d&&d.id===e.id&&o(t=>({...t,...e})))};return(0,a.jsxs)("div",{className:"flex h-screen bg-gray-100 dark:bg-zinc-900",children:[(0,a.jsx)("div",{className:"left-panel w-[300px] bg-white dark:bg-zinc-950 border-r border-gray-300 dark:border-zinc-800 flex-shrink-0 flex flex-col",children:(0,a.jsx)(I,{content:g,setContent:m,levels:e,currentLevelName:i,loadLevel:t=>Y(t,e),onCreateLevel:V,canvasSize:w,setCanvasSize:N,placingObject:u,setPlacingObject:p,fruitDimensions:z,onFruitDimensionChange:(e,t)=>{let i={...z,[e]:t};_(i),localStorage.setItem("fruit-dimensions",JSON.stringify(i))},stoneDimensions:F,onStoneDimensionChange:(e,t)=>{let i={...F,[e]:t};P(i),localStorage.setItem("stone-dimensions",JSON.stringify(i))},waterDimensions:W,onWaterDimensionChange:(e,t)=>{let i={...W,[e]:t};H(i),localStorage.setItem("water-dimensions",JSON.stringify(i))},treeDimensions:J,onTreeDimensionChange:(e,t)=>{let i={...J,[e]:t};D(i),localStorage.setItem("tree-dimensions",JSON.stringify(i))},finishDimensions:A,onFinishDimensionChange:(e,t)=>{let i={...A,[e]:t};L(i),localStorage.setItem("finish-dimensions",JSON.stringify(i))},extraDimensions:T,onExtraDimensionChange:(e,t)=>{let i={...T,[e]:t};X(i),localStorage.setItem("extra-dimensions",JSON.stringify(i))}})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,a.jsx)(x,{activeTool:c,onToolSelect:e=>{"pointer"===e&&p(null),h(e)},onSave:B,isSaving:b}),(0,a.jsx)("main",{ref:y,className:"flex-1 relative bg-gray-300 dark:bg-zinc-800 overflow-auto",children:(0,a.jsx)(R,{mapObjects:r,setMapObjects:l,selectedObject:d,setSelectedObject:o,canvasSize:w,placingObject:u,setPlacingObject:p,keepAspectRatio:f,onUpdateObject:G})})]}),(0,a.jsx)("div",{className:"right-panel w-[300px] bg-white dark:bg-zinc-950 border-l border-gray-300 dark:border-zinc-800 flex-shrink-0",children:(0,a.jsx)(E,{mapObjects:r,selectedObject:d,onSelectObject:o,onUpdateObject:G,onDeleteObject:e=>{l(r.filter(t=>t.id!==e)),o(null)},leftPanelContent:g,canvasSize:w,setCanvasSize:N,keepAspectRatio:f,setKeepAspectRatio:v})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[967,441,684,358],()=>t(7975)),_N_E=e.O()}]);