(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{338:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>E});var s=i(5155),a=i(2115),n=i(112),l=i(3191),r=i(9416),o=i(8801),d=i(9511);let h=e=>{let{activeTool:t,onToolSelect:i,onSave:a,isSaving:h}=e;return(0,s.jsxs)(n.Y,{justify:"space-between",p:"xs",style:{borderBottom:"1px solid #e0e0e0"},children:[(0,s.jsx)(n.Y,{children:(0,s.jsx)(l.M,{variant:"pointer"===t?"filled":"default",onClick:()=>i("pointer"),"aria-label":"Pointer",size:"lg",children:(0,s.jsx)(r.A,{size:24})})}),(0,s.jsxs)(n.Y,{children:[(0,s.jsx)(l.M,{variant:"map"===t?"filled":"default",onClick:()=>i("map"),"aria-label":"Map",mr:"md",size:"lg",children:(0,s.jsx)(o.A,{size:24})}),(0,s.jsx)(l.M,{onClick:a,"aria-label":"Save",loading:h,variant:"default",size:"lg",children:(0,s.jsx)(d.A,{size:24})})]})]})},c={islands:"Остров",start:"Старт",fruits:"Фрукты",stones:"Камни",water:"Вода",trees:"Деревья",finish:"Финиш",extra:"Экстра"},g={islands:[{name:"Остров 1",image:"/assets/islands/island_1.png"},{name:"Остров 2",image:"/assets/islands/island_2.png"},{name:"Остров 3",image:"/assets/islands/island_3.png"}],start:[{name:"Корова",image:"/assets/hero/hero_cow.png"},{name:"Кот",image:"/assets/hero/hero_cat.png"}],fruits:[{name:"Яблоко",image:"/assets/fruits/apple.png"},{name:"Банан",image:"/assets/fruits/banana.png"},{name:"Ягода",image:"/assets/fruits/berry.png"},{name:"Капуста",image:"/assets/fruits/cabbage.png"},{name:"Морковь",image:"/assets/fruits/carrot.png"},{name:"Виноград",image:"/assets/fruits/grape.png"}],stones:[{name:"Камень 1",image:"/assets/stones/stone_1.png"},{name:"Камень 2",image:"/assets/stones/stone_2.png"},{name:"Камень 3",image:"/assets/stones/stone_3.png"}],water:[{name:"Вода 1",image:"/assets/water/water_1.png"},{name:"Вода 2",image:"/assets/water/water_2.png"},{name:"Вода 3",image:"/assets/water/water_3.png"},{name:"Вода 4",image:"/assets/water/water_4.png"}],trees:[{name:"Дерево 1",image:"/assets/trees/tree_1.png"},{name:"Дерево 2",image:"/assets/trees/tree_2.png"},{name:"Дерево 3",image:"/assets/trees/tree_3.png"},{name:"Дерево 4",image:"/assets/trees/tree_4.png"}],finish:[{name:"Финиш 1",image:"/assets/finish/finish_1.png"}],extra:[{name:"Экстра 1",image:"/assets/extra/extra_1.png"}]};var m=i(6766),u=i(1220),p=i(6707),x=i(3129),f=i(3751),j=i(1430),b=i(3885),v=i(1395),w=i(3608),S=i(8169);let y=["islands","start","fruits","stones","water","trees","finish","extra"],C={fruits:"фрукт",stones:"камень",trees:"дерево",finish:"финиш",extra:"экстра",water:"объект"},N={fruits:"fruit",stones:"stone",trees:"tree",finish:"finish",extra:"extra",water:"water"},O=e=>{let{content:t,levels:i,currentLevelName:l,loadLevel:r,onCreateLevel:o,canvasSize:d,setCanvasSize:h,placingObject:O,setPlacingObject:k,islandDimensions:_,onIslandDimensionChange:I,startDimensions:D,onStartDimensionChange:W,fruitDimensions:J,onFruitDimensionChange:z,stoneDimensions:H,onStoneDimensionChange:M,waterDimensions:P,onWaterDimensionChange:E,treeDimensions:T,onTreeDimensionChange:Y,finishDimensions:B,onFinishDimensionChange:Q,extraDimensions:$,onExtraDimensionChange:L}=e,[A,F]=(0,a.useState)("islands"),[R,X]=(0,a.useState)(null),[U,G]=(0,a.useState)(!0),[K,q]=(0,a.useState)({width:0,height:0});(0,a.useEffect)(()=>{X(null)},[A]);let V=e=>{if((null==O?void 0:O.name)===e.name)k(null),X(null);else{let t=new window.Image;t.src=e.image,t.onload=()=>{let i,s,a="islands"===A,n="start"===A,l="fruits"===A,r="stones"===A,o="water"===A,d="trees"===A,h="finish"===A,c="extra"===A,g=J;a&&(g=_),n&&(g=D),r&&(g=H),o&&(g=P),d&&(g=T),h&&(g=B),c&&(g=$);let m=g[e.name];if((a||n||l||r||o||d||h||c)&&m)i=m.width,s=m.height;else if(a||n||l||r||o||d||h||c)i=64,s=64;else{let e=Math.min(1,128/t.naturalWidth,128/t.naturalHeight);i=t.naturalWidth*e,s=t.naturalHeight*e}k({...e,width:i,height:s,originalWidth:t.naturalWidth,originalHeight:t.naturalHeight}),a||n||l||r||o||d||h||c?(X(e.name),q({width:i,height:s})):X(null)}}},Z=(e,t)=>{let i=Number(t);!isNaN(i)&&i>0&&h({...d,[e]:i})},ee=(e,t,i)=>{let s=Number(t);if(R&&!isNaN(s)&&s>0)if(U){let t={islandDimensions:_,startDimensions:D,fruitDimensions:J,stoneDimensions:H,waterDimensions:P,treeDimensions:T,finishDimensions:B,extraDimensions:$}["".concat(i,"Dimensions")][R],a=t?t.width/t.height:1;"width"===e?q({width:s,height:Math.round(s/a)}):q({width:Math.round(s*a),height:s})}else q(t=>({...t,[e]:s}))},et=()=>{if(R&&A){let e={islands:I,start:W,fruits:z,stones:M,water:E,trees:Y,finish:Q,extra:L}[A];e&&e(R,K)}};return(0,s.jsx)(b.a,{py:"sm",children:(()=>{if("levels"===t)return(0,s.jsxs)(u.B,{p:"md",children:[(0,s.jsx)(p.$,{onClick:o,fullWidth:!0,children:"Создать новый уровень"}),(0,s.jsx)(u.B,{gap:"xs",mt:"sm",children:Object.keys(i).map(e=>(0,s.jsx)(x.k,{href:"#",label:e,active:l===e,onClick:()=>r(e),variant:"filled"},e))})]});if("settings"===t)return(0,s.jsxs)(u.B,{p:"md",children:[(0,s.jsx)(f.h,{order:4,children:"Настройки"}),(0,s.jsx)(j.Q,{label:"Ширина",value:d.width,onChange:e=>Z("width",e)}),(0,s.jsx)(j.Q,{label:"Высота",value:d.height,onChange:e=>Z("height",e)})]});let e=A?g[A]:null,a=A&&y.includes(A),h=A?"random_".concat(N[A]||A):"",I=A?"/assets/".concat(A,"/random_").concat(N[A]||A,".png"):"",W=A?"Случайный ".concat(C[A]||c[A]):"";return(0,s.jsxs)(u.B,{p:"md",gap:"lg",style:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,s.jsxs)(b.a,{children:[(0,s.jsx)(f.h,{order:4,mb:"md",children:"Элементы"}),(0,s.jsx)(n.Y,{children:Object.entries(c).map(e=>{let[t,i]=e;return(0,s.jsx)(p.$,{variant:A===t?"filled":"light",onClick:()=>F(t),radius:"md",children:i},t)})})]}),(0,s.jsx)(b.a,{style:{flex:"1 1 auto",overflowY:"auto"},children:A&&e&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.c,{}),(0,s.jsxs)("div",{children:[(0,s.jsx)(f.h,{order:4,tt:"capitalize",mt:"lg",mb:"md",children:c[A]}),(0,s.jsxs)(b.a,{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.5rem"},children:[e.map(e=>(0,s.jsx)(w.N,{p:"xs",style:{borderRadius:"var(--mantine-radius-md)",border:(null==O?void 0:O.name)===e.name?"2px solid var(--mantine-color-blue-6)":"2px solid transparent"},className:"hover:bg-gray-100",onClick:()=>V(e),children:(0,s.jsx)(u.B,{align:"center",gap:"xs",children:(0,s.jsx)(m.default,{src:e.image,alt:e.name,width:56,height:56})})},e.name)),a&&A&&(0,s.jsx)(w.N,{p:"xs",style:{borderRadius:"var(--mantine-radius-md)",border:(null==O?void 0:O.name)===h?"2px solid var(--mantine-color-blue-6)":"2px solid transparent"},className:"hover:bg-gray-100",onClick:()=>{if((null==O?void 0:O.name)===h)k(null),X(null);else{let e={islands:_,start:D,fruits:J,stones:H,water:P,trees:T,finish:B,extra:$}[A],t=e?e[h]:void 0,i=(null==t?void 0:t.width)||64,s=(null==t?void 0:t.height)||64;k({name:h,image:I,width:i,height:s,originalWidth:i,originalHeight:s}),X(h)}},children:(0,s.jsx)(u.B,{align:"center",gap:"xs",children:(0,s.jsx)(m.default,{src:I,alt:W,width:56,height:56})})},h)]})]})]})}),R&&A&&y.includes(A)&&(0,s.jsxs)(b.a,{children:[(0,s.jsx)(v.c,{}),(0,s.jsxs)(f.h,{order:4,tt:"capitalize",mt:"lg",mb:"md",children:["Размер для: ",R]}),(0,s.jsxs)(n.Y,{children:[(0,s.jsx)(j.Q,{label:"Ширина",value:K.width,onChange:e=>ee("width",e,A)}),(0,s.jsx)(j.Q,{label:"Высота",value:K.height,onChange:e=>ee("height",e,A)})]}),(0,s.jsx)(S.S,{mt:"md",checked:U,onChange:e=>G(e.currentTarget.checked),label:"Сохранять пропорции"}),(0,s.jsx)(p.$,{mt:"md",onClick:et,children:"Сохранить"})]})]})})()})};var k=i(2723),_=i(8887),I=i(8593),D=i(6701);let W=e=>{let{objects:t,onSelectObject:i,selectedObject:a}=e,l=(e=>{let t=new Map;e.forEach(e=>{t.set(e.id,{...e,children:[]})});let i=[];return e.forEach(e=>{if(e.parentId&&t.has(e.parentId)){var s;let i=t.get(e.parentId);null==i||null==(s=i.children)||s.push(t.get(e.id))}else i.push(t.get(e.id))}),i})(t),r=e=>(0,s.jsx)("div",{style:{paddingLeft:16},children:e.map(e=>(0,s.jsxs)("div",{children:[(0,s.jsx)(w.N,{onClick:()=>i(e),style:{display:"block",width:"100%",padding:"4px 8px",borderRadius:"4px",backgroundColor:(null==a?void 0:a.id)===e.id?"#e7f5ff":"transparent",color:(null==a?void 0:a.id)===e.id?"#1971c2":"#000"},children:(0,s.jsx)(n.Y,{children:(0,s.jsx)(_.E,{size:"sm",children:e.name})})}),e.children&&e.children.length>0&&r(e.children)]},e.id))});return(0,s.jsx)("div",{children:r(l)})},J=e=>{let{mapObjects:t,selectedObject:i,onSelectObject:r,onUpdateObject:o,onDeleteObject:d,leftPanelContent:h,canvasSize:c,setCanvasSize:g,keepAspectRatio:m,setKeepAspectRatio:x}=e,[b,v]=(0,a.useState)("properties"),w=(e,t)=>{if(!i)return;let s={...i,[e]:t};if(m)if("width"===e&&i.originalWidth&&i.originalHeight){let e=i.originalHeight/i.originalWidth;s.height=Number(t)*e}else if("height"===e&&i.originalWidth&&i.originalHeight){let e=i.originalWidth/i.originalHeight;s.width=Number(t)*e}else"widthPercent"===e&&i.originalWidth&&i.originalHeight?s.height=i.originalHeight*(Number(t)/100):"heightPercent"===e&&i.originalWidth&&i.originalHeight&&(s.width=i.originalWidth*(Number(t)/100));"widthPercent"===e&&i.originalWidth?s.width=i.originalWidth*(Number(t)/100):"heightPercent"===e&&i.originalHeight&&(s.height=i.originalHeight*(Number(t)/100)),o(s)},y=(e,t)=>{g({...c,[e]:Number(t)||0})};return"levels"===h?(0,s.jsxs)(u.B,{children:[(0,s.jsx)(f.h,{order:4,children:"Размеры уровня"}),(0,s.jsx)(j.Q,{label:"Ширина",id:"width",value:c.width,onChange:e=>y("width",e),min:100}),(0,s.jsx)(j.Q,{label:"Высота",id:"height",value:c.height,onChange:e=>y("height",e),min:100})]}):(0,s.jsxs)(u.B,{children:[(0,s.jsx)(k.I,{value:b,onChange:e=>v(e),data:[{label:"Свойства",value:"properties"},{label:"Дерево",value:"tree"}],fullWidth:!0}),"tree"===b&&(0,s.jsxs)(u.B,{children:[(0,s.jsx)(f.h,{order:4,children:"Дерево объектов"}),(0,s.jsx)(W,{objects:t,onSelectObject:r,selectedObject:i})]}),"properties"===b&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.Y,{justify:"space-between",children:[(0,s.jsx)(f.h,{order:4,children:"Свойства объекта"}),i&&(0,s.jsx)(l.M,{variant:"light",color:"red",onClick:()=>d(i.id),children:(0,s.jsx)(D.A,{size:18})})]}),i?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(I.k,{label:"Имя",value:i.name,onChange:e=>o({...i,name:e.currentTarget.value})}),(0,s.jsx)(j.Q,{label:"Ширина (пикс.)",id:"width",value:Math.round(i.width),onChange:e=>w("width",e),min:1}),(0,s.jsx)(j.Q,{label:"Высота (пикс.)",id:"height",value:Math.round(i.height),onChange:e=>w("height",e),min:1}),i.originalWidth&&(0,s.jsx)(j.Q,{label:"Ширина (%)",value:Math.round(i.width/i.originalWidth*100),onChange:e=>w("widthPercent",e),min:1}),i.originalHeight&&(0,s.jsx)(j.Q,{label:"Высота (%)",value:Math.round(i.height/i.originalHeight*100),onChange:e=>w("heightPercent",e),min:1}),(0,s.jsx)(S.S,{checked:m,onChange:e=>x(e.currentTarget.checked),label:"Сохранять пропорции"}),(0,s.jsxs)(n.Y,{grow:!0,children:[(0,s.jsx)(p.$,{variant:"default",onClick:()=>o({...i,flipX:!i.flipX}),children:"Отразить X"}),(0,s.jsx)(p.$,{variant:"default",onClick:()=>o({...i,flipY:!i.flipY}),children:"Отразить Y"})]}),(0,s.jsx)(S.S,{id:"isLocked",label:"Заблокировать",checked:i.isLocked,onChange:e=>w("isLocked",e.currentTarget.checked)})]}):(0,s.jsx)(_.E,{c:"dimmed",children:"Объект не выбран"})]})]})};var z=i(5028),H=i(6942),M=i(3020);let P=(0,z.default)(()=>Promise.all([i.e(413),i.e(650),i.e(60)]).then(i.bind(i,7060)),{loadableGenerated:{webpack:()=>[7060]},ssr:!1,loading:()=>(0,s.jsx)("div",{className:"flex-grow flex justify-center items-center bg-gray-100",children:(0,s.jsx)("p",{children:"Loading Canvas..."})})});function E(){let[e,t]=(0,a.useState)({}),[i,n]=(0,a.useState)(""),[l,r]=(0,a.useState)([]),[o,d]=(0,a.useState)(null),[c,g]=(0,a.useState)("pointer"),[m,u]=(0,a.useState)("islands"),[p,x]=(0,a.useState)(null),[f,j]=(0,a.useState)(!0),[b,v]=(0,a.useState)(!1),[w,S]=(0,a.useState)({width:800,height:600}),[y,C]=(0,a.useState)({}),[N,k]=(0,a.useState)({}),[_,I]=(0,a.useState)({}),[D,W]=(0,a.useState)({}),[z,E]=(0,a.useState)({}),[T,Y]=(0,a.useState)({}),[B,Q]=(0,a.useState)({}),[$,L]=(0,a.useState)({}),A=async()=>{let e=await fetch("/api/levels"),i=await e.json();return t(i),i};(0,a.useEffect)(()=>{(async()=>{let e=await A(),t=Object.keys(e),i=localStorage.getItem("maze-editor-last-level-name");i&&e[i]?F(i,e):t.length>0&&F(t[0],e)})()},[]),(0,a.useEffect)(()=>{"map"===c?u("levels"):"pointer"===c&&"levels"===m&&u("islands")},[c,m]),(0,a.useEffect)(()=>{let e=localStorage.getItem("fruit-dimensions");e&&I(JSON.parse(e));let t=localStorage.getItem("stone-dimensions");t&&W(JSON.parse(t));let i=localStorage.getItem("water-dimensions");i&&E(JSON.parse(i));let s=localStorage.getItem("tree-dimensions");s&&Y(JSON.parse(s));let a=localStorage.getItem("finish-dimensions");a&&Q(JSON.parse(a));let n=localStorage.getItem("extra-dimensions");n&&L(JSON.parse(n));let l=localStorage.getItem("island-dimensions");l&&C(JSON.parse(l));let r=localStorage.getItem("start-dimensions");r&&k(JSON.parse(r))},[]),(0,a.useEffect)(()=>{p?g("placing"):"placing"===c&&g("pointer")},[p,c]);let F=(e,t)=>{let i=t[e];i&&(r(i.objects||[]),S(i.dimensions||{width:800,height:600}),n(e),d(null),localStorage.setItem("maze-editor-last-level-name",e))},R=async()=>{let t=prompt("Введите имя нового уровня:","Уровень ".concat(Object.keys(e).length+1));if(t){if(e[t])return void alert("Уровень с таким именем уже существует.");try{await fetch("/api/save-level",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,data:{objects:[],dimensions:{width:800,height:600}}})});let e=await A();F(t,e)}catch(e){console.error("Ошибка при создании уровня:",e),alert("Не удалось создать уровень: ".concat(e))}}},X=async()=>{if(!i)return void H.$e.show({title:"Ошибка",message:"Не выбран уровень для сохранения.",color:"red"});v(!0);try{await fetch("/api/save-level",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,data:{objects:l,dimensions:w}})}),H.$e.show({title:"Сохранено",message:'Уровень "'.concat(i,'" успешно сохранен.'),color:"green"})}catch(e){console.error("Ошибка при сохранении уровня:",e),H.$e.show({title:"Ошибка сохранения",message:"Не удалось сохранить уровень: ".concat(e),color:"red"})}finally{v(!1)}},U=e=>{e.id&&(r(l.map(t=>t.id===e.id?{...t,...e}:t)),o&&o.id===e.id&&d(t=>({...t,...e})))};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.$,{position:"bottom-right",limit:3}),(0,s.jsx)("div",{className:"app-container flex flex-col h-screen",children:(0,s.jsxs)("main",{className:"main-content flex flex-grow overflow-hidden",children:[(0,s.jsx)("div",{className:"left-panel w-[250px] bg-white border-r border-gray-300 flex-shrink-0 flex",children:(0,s.jsx)(O,{content:m,setContent:u,levels:e,currentLevelName:i,loadLevel:t=>F(t,e),onCreateLevel:R,canvasSize:w,setCanvasSize:S,placingObject:p,setPlacingObject:x,islandDimensions:y,onIslandDimensionChange:(e,t)=>{let i={...y,[e]:t};C(i),localStorage.setItem("island-dimensions",JSON.stringify(i))},startDimensions:N,onStartDimensionChange:(e,t)=>{let i={...N,[e]:t};k(i),localStorage.setItem("start-dimensions",JSON.stringify(i))},fruitDimensions:_,onFruitDimensionChange:(e,t)=>{let i={..._,[e]:t};I(i),localStorage.setItem("fruit-dimensions",JSON.stringify(i))},stoneDimensions:D,onStoneDimensionChange:(e,t)=>{let i={...D,[e]:t};W(i),localStorage.setItem("stone-dimensions",JSON.stringify(i))},waterDimensions:z,onWaterDimensionChange:(e,t)=>{let i={...z,[e]:t};E(i),localStorage.setItem("water-dimensions",JSON.stringify(i))},treeDimensions:T,onTreeDimensionChange:(e,t)=>{let i={...T,[e]:t};Y(i),localStorage.setItem("tree-dimensions",JSON.stringify(i))},finishDimensions:B,onFinishDimensionChange:(e,t)=>{let i={...B,[e]:t};Q(i),localStorage.setItem("finish-dimensions",JSON.stringify(i))},extraDimensions:$,onExtraDimensionChange:(e,t)=>{let i={...$,[e]:t};L(i),localStorage.setItem("extra-dimensions",JSON.stringify(i))}})}),(0,s.jsxs)("div",{className:"center-panel flex-grow flex flex-col min-w-0",children:[(0,s.jsx)(h,{activeTool:c,onToolSelect:e=>{"pointer"===e&&x(null),g(e)},onSave:X,isSaving:b}),(0,s.jsx)("div",{className:"canvas-container flex-grow overflow-auto bg-gray-100 p-5 flex justify-center items-center",children:(0,s.jsx)(P,{mapObjects:l,setMapObjects:r,selectedObject:o,setSelectedObject:d,canvasSize:w,placingObject:p,setPlacingObject:x,keepAspectRatio:f,onUpdateObject:U})})]}),(0,s.jsx)("div",{className:"right-panel w-[250px] bg-white border-l border-gray-300 p-4 overflow-y-auto flex-shrink-0",children:(0,s.jsx)(J,{mapObjects:l,selectedObject:o,onSelectObject:d,onUpdateObject:U,onDeleteObject:e=>{r(l.filter(t=>t.id!==e)),d(null)},leftPanelContent:m,canvasSize:w,setCanvasSize:S,keepAspectRatio:f,setKeepAspectRatio:j})})]})})]})}},5494:(e,t,i)=>{Promise.resolve().then(i.bind(i,338))}},e=>{var t=t=>e(e.s=t);e.O(0,[227,441,684,358],()=>t(5494)),_N_E=e.O()}]);