"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[60],{7060:(e,t,i)=>{i.r(t),i.d(t,{default:()=>u});var l=i(5155),h=i(2115),n=i(7579),r=i(5510),a=i.n(r),s=i(1368);let g=e=>{let{shapeProps:t,isSelected:i,onSelect:r,onChange:s,keepAspectRatio:g}=e,u=(0,h.useRef)(null),d=(0,h.useRef)(null),[o]=a()(t.image,"anonymous");return(0,h.useEffect)(()=>{if(i){var e,t,l;null==(e=d.current)||e.nodes([u.current]),null==(l=d.current)||null==(t=l.getLayer())||t.batchDraw()}},[i]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n._V,{ref:u,image:o,x:t.x,y:t.y,width:t.width,height:t.height,draggable:!t.isLocked,onClick:r,onTap:r,onDragEnd:e=>{s({...t,x:e.target.x(),y:e.target.y()})},onTransformEnd:()=>{let e=u.current;if(e){let i=e.scaleX(),l=e.scaleY();e.scaleX(t.flipX?-1:1),e.scaleY(t.flipY?-1:1),s({...t,x:e.x(),y:e.y(),width:Math.max(5,e.width()*Math.abs(i)),height:Math.max(5,e.height()*Math.abs(l))})}},scaleX:t.flipX?-1:1,scaleY:t.flipY?-1:1,offsetX:t.flipX?t.width:0,offsetY:t.flipY?t.height:0}),i&&(0,l.jsx)(n.Ge,{ref:d,boundBoxFunc:(e,t)=>{if(g){let i=e.width/e.height;t.width=t.height*i}return t.width<5||t.height<5?e:t}})]})},u=e=>{let{mapObjects:t,setMapObjects:i,selectedObject:r,setSelectedObject:u,canvasSize:d,placingObject:o,setPlacingObject:c,keepAspectRatio:f,onUpdateObject:w}=e,[x,p]=(0,h.useState)(null),m=(0,h.useRef)(null),y=(0,h.useRef)(null),k=e=>{var t;if(!e)return null;let i=e.getAbsoluteTransform().copy();i.invert();let l=null==(t=e.getStage())?void 0:t.getPointerPosition();return l?i.point(l):null},[b]=a()((null==o?void 0:o.image)||"","anonymous");return(0,l.jsx)(n.BI,{ref:m,width:d.width+2e3,height:d.height+2e3,onClick:e=>{if(o&&y.current){let e=k(y.current);if(!e)return;"random_fruit"===o.name?i([...t,{id:(0,s.A)(),name:"Случайный фрукт",image:o.image,x:e.x-o.width/2,y:e.y-o.height/2,width:o.width,height:o.height,originalWidth:o.originalWidth,originalHeight:o.originalHeight,flipX:!1,flipY:!1,isLocked:!1}]):i([...t,{id:(0,s.A)(),...o,x:e.x-o.width/2,y:e.y-o.height/2,flipX:!1,flipY:!1,isLocked:!1}]),c(null);return}(e.target===e.target.getStage()||"level-background"===e.target.name())&&u(null)},onMouseMove:()=>{if(o&&y.current){let e=k(y.current);e&&p(e)}},onMouseLeave:()=>{p(null)},className:"bg-gray-100",children:(0,l.jsx)(n.Wd,{children:(0,l.jsxs)(n.YJ,{ref:y,x:1e3,y:1e3,children:[(0,l.jsx)(n.rw,{name:"level-background",width:d.width,height:d.height,fill:"white",shadowBlur:10,shadowOpacity:.2}),t.map(e=>(0,l.jsx)(g,{shapeProps:e,isSelected:(null==r?void 0:r.id)===e.id,onSelect:()=>{!o&&(e.isLocked||u(e))},onChange:w,keepAspectRatio:f},e.id)),x&&o&&(0,l.jsx)(n._V,{image:b,x:x.x-o.width/2,y:x.y-o.height/2,width:o.width,height:o.height,opacity:.6,listening:!1})]})})})}}}]);